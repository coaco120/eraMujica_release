# 傻瓜都懂的口上制作教程
口上制作教程。
考虑到有些人可能只是想简单做一些剧情差分，也有些人可能会想更深入了解这个游戏，教程可能、也许、MAYBE会有基础版和进阶版两种
现在放出的是基础版，只需要按部就班即可实现剧情差分

<font color=red>因本人也还在摸索中，有些注释我也看不懂，有些地方可能有错，或者不是最优解决，欢迎加群沟通交流，一同进步</font>

[TOC]
- [傻瓜都懂的口上制作教程](#傻瓜都懂的口上制作教程)
	- [教程食用说明](#教程食用说明)
	- [基础知识](#基础知识)
		- [角色番号](#角色番号)
		- [事件编号](#事件编号)
		- [文件类型](#文件类型)
	- [制作口上](#制作口上)
		- [新增角色口上步骤总览](#新增角色口上步骤总览)
		- [修改口上配置文件](#修改口上配置文件)
			- [口上存在判定](#口上存在判定)
			- [口上色设定](#口上色设定)
			- [注意事项](#注意事项)
		- [编写口上事件](#编写口上事件)
			- [给大闲者的无聊代码小常识](#给大闲者的无聊代码小常识)
				- [注释](#注释)
				- [定义函数](#定义函数)
				- [返回值](#返回值)
			- [修改口上事件函数名](#修改口上事件函数名)
				- [神马是函数名](#神马是函数名)
			- [编写口上内容](#编写口上内容)
			- [完成！！](#完成)
			- [小小的进阶](#小小的进阶)
				- [思路](#思路)
				- [IF \[条件\]](#if-条件)
				- [SELECTCASE \[参数\]](#selectcase-参数)
			- [具体实现](#具体实现)
				- [用IF语句实现](#用if语句实现)
				- [SELECTCASE](#selectcase)
	- [结语](#结语)

## 教程食用说明
教程内含有范例文件文件夹，为机翻+本人修改整理，含有常用的口上事件（EVENT）。<em>实际上除了事件外，还有行动（ACT）、商店(SHOP)等功能，应该是差不多逻辑，之后有空会逐步整理出来。</em>

## 基础知识
### 角色番号
每个角色都有角色番号，角色番号可视为角色的身份证号码，有且仅有一个。
在新增口上时，最重要的就是修改角色番号了。
可以从根目录->CSV->CHARA中，角色对应的文件中查找

### 事件编号
类似于角色番号是角色的身份证号，事件编号是事件的身份证号

### 文件类型
本教程涉及了两种文件：
* 口上配置文件（KOJO_K99.ERB）
* 口上事件（EVENT）文件(KOJO_EVENT_K99文件夹下的所有文件)

口上配置文件是为<STRONG>设置口上参数用的</STRONG>；口上事件文件则是<STRONG>实现具体功能</STRONG>，既我们编写具体剧情时既在这里

## 制作口上
### 新增角色口上步骤总览
当需要新增一个角色的口上时：
1. 将范例文件文件夹整个拷贝至:根目录->ERB->口上中
2. 修改文件夹名称（建议按照原有格式，既[角色番号]_[角色名称]的格式）；修改KOJO_K99.ERB名称（KOJO_K[角色番号].ERB）
3. 修改KOJO_K99.ERB文件的函数名,可根据需求修改配置内容（[详细说明](#修改口上配置文件)）
4. 修改KOJO_EVENT_K99文件夹下的口上事件函数名（[详细说明](#修改口上事件函数名)）。<STRONG>为减少工作量，以及避免混淆，先确定好要实现的功能后，将不需要的文件和事件删除</STRONG>
5. 实现口上事件具体功能（[详细说明](#编写口上内容)）

### 修改口上配置文件
范例文件中，口上配置文件为KOJO_K99.ERB
一般来说，根据需要修改作者名、字体颜色和注意事项即可。有更多需要，可以自行查阅该文件内容

#### 口上存在判定
```
@KOJO_K1
RESULTS:1 = 这里填写口上的作者名字
```
#### 口上色设定
```
@KOJO_COLOR_K1
;这里的颜色会在角色选择页面中，当角色有口上时改变字体颜色（支持十进制和十六进制的RGB格式）
SETCOLOR 4,146,195
```

#### 注意事项
```
@KOJO_ATTENTION_K1
PRINTFORMDW 这里填写的内容会在选择人物后显示，可以根据需要填写
```

### 编写口上事件
范例文件中，口上事件文件都在KOJO_EVENT_K99文件夹下，文件名既标明了文件对应的事件编号和事件内容
下面列出目前范例文件中涵括的事件列表，其中16、17都在EVENT_OTHERS.ERB文件中

| 事件编号      | 描述 |
| ----------- | ----------- |
| 1      | 开场对话       |
| 2   | 结局事件        |
| 7   | 项圈        |
| 8   | 妊娠事件        |
| 11   | 调教开始        |
| 12   | 调教行动前        |
| 13   | 调教终了        |
| 16   | 大满足奖励        |
| 17   | 当日方针        |

在实现口上时，先确认好要实现哪些事件，为避免出现冲突等问题，不需要的文件、事件请删除
接着我们要做的就是[修改口上事件函数名](#修改口上事件函数名)以及[编写口上内容](#编写口上内容)

#### 给大闲者的无聊代码小常识
这部分可不可看？可堪可看，可看可不看
##### 注释
我们会在代码中看到很多这样的内容
```
;========================================================================
;EV1, 开场对话
;========================================================================
;・仅当对话发起者(TARGET)为主人时显示
;・若返回值为2，则跳过OP后的主程序标题LOGO
;・非普通模式下，调教对象可能不符合NO:MASTER == 0（即非所谓的%CALLNAME:MASTER%）
;-------------------------------------------------
;关联变量...
;FLAG:モード (FLAG:模式)(0=普通/1=沙盒/9=额外)
;-------------------------------------------------
```
在ERA的代码中，;后面的内容叫做<strong>注释</STRONG>，这些内容是不会执行，主要用途是给人类阅读的
只想实现简单功能的朋友们其实大部分内容可以不管。如果是有兴趣搞些更复杂的功能的，可以好好阅读一下这些注释,说不定能实现你想要的一些功能

##### 定义函数
```
@KOJO_EVENT_K99_1(ARG)
```
简单来说，这一行代码的作用是告诉计算机我们需要定义一个叫KOJO_EVENT_K99_1的函数
* 函数，是程序中用来实现某个特定目的的，一串代码
* 函数要有返回值
* (ARG)部分是函数传递的参数，基础版本中，我们不需要理解，照着写就好了

##### 返回值
```
@KOJO_EVENT_K99_1(ARG)
RETURN 1
```
每一个函数最后你都会看到一个RETURN，它后面跟着一个数值，那个就是返回值
RETURN会将函数的结果返回给上一级。换一个人话就是谁喊它干活的，它就把执行的结果告诉谁
注释中有时会告诉我们不同返回值能实现什么效果，但其实大部分时候，我们不需要修改它

#### 修改口上事件函数名
```
@KOJO_EVENT_K99_1(ARG)
```
代码中有一行@KOJO_EVENT_K99_1,这是非常关键的代码，也是我们需要修改的内容
##### 神马是函数名
简单来说，这一行代码的作用是告诉计算机我们需要定义一个叫KOJO_EVENT_K99_1的函数（不理解什么是函数也没事，就叫它功能吧）。其中K99的99是人物番号，后面的1是事件编号，既这个函数名可以翻译成中文：实现的是编号为99的人物的编号1的口上事件的函数
也就是说，如果我们需要给一个人物番号为66的角色，增加一个大满足奖励（事件编号为16）的口上，就需要定义一个叫KOJO_EVENT_K66_16的功能（这个功能可以在EVENT_OTHERS.ERB看到）
所以，==当在新增角色口上时，一定要将这些功能名称中的K99，修改为新角色的番号==

**！！！重要的事情说三遍**
将需要实现的功能的函数名中的K99都改为K[新角色编号]

#### 编写口上内容
太好啦！看到这一步的你已经完成绝大部分琐碎的事，可以实现具体功能了
以开场白事件为范例，当我们需要修改自己的开场白时，可以用如下代码实现
```
@KOJO_EVENT_K99_1(ARG)    
	PRINTFORMDW 这个会将本行信息打印在界面上，只需要将这些中文替换成你自己文字即可
	PRINTFORML
	PRINTFORMDW 上面的那一行代码，可以空出一行来，学费了吧？
	PRINTFORMDW %CALLNAME:TARGET%前面这一串可以显示调教者的名字
	PRINTFORMDW %CALLNAME:MASTER%前面这一串可以显示被调教者的名字
	PRINTFORML
	PRINTFORMDW 注意，是%CALLNAME:TARGET%在调教%CALLNAME:MASTER%哦
	PRINTFORMDW 学会了吧？现在你可以开始写自己的故事啦
	PRINTFORML
	RETURN 1
```
看到KOJO_EVENT_K99_1了吧？和我一起复述一遍：它是一个实现角色番号99角色的编号为1的口上事件的函数
而开场白，无疑就是需要在屏幕上显示一些东西，PRINTFORMDW和PRINTFORML函数就是为此而生的
PRINTFORML会输出一行空行，在做格式时可以用到
PRINTFORMDW会打印出后面写的内容，记得二者之间要有空格。当然它的功能不只如此，它可以动态显示文字，例如角色的名字（代码中有示范哦）或者一些参数，不过当前我们学习动态显示名字就好了，毕竟后面的功能我也没研究明白，等有需要再说吧

#### 完成！！
上面的内容，就足以让我们修改出独属于某个角色的开场白了，而其他的口上事件也大抵如此，找到要修改的事件，将对应的函数名修改为新角色番号，然后找到输出文字信息的部分，将它们替换成你自己的内容即可
但说的很简单，打开某个文件想改又开始头大了是吧？
没关系，我们开始小小升级以下

#### 小小的进阶
按上面步骤做出开场白口上后，大家可能会发现这个人物的开场白对谁都是一样的，但游玩游戏自带角色时，明明同一个调教主，但不同被调教角色会显示不同的开场白，这到底是为什么呢？
是因为某个人真的超勇哦，真的这样写完了，口怕啊（不对）
实际上，这个实现需要用到一点小小的代码
在这里我会简单教下大家，是怎么实现这个效果的

##### 思路
在编程时，我们经常写逻辑判断，来决定每个状态下要做什么
在思路下，只要我们知道当前调教者是谁（口上中是固定不变的）、被调教的角色是谁，就能给出不同的开场白了
现在动动我们聪明的小脑瓜，我们上面说过有什么能唯一标识角色的东西呢？
对辣，就是角色番号，在代码中可以通过NO:MASTER获取
接着我们来学程序中，怎么判断两者一致的方法

<EM>类似于NO:MASTER的参数还有很多，其实上面打印中用到的CALLNAME:MASTER也是参数。打开示例文件，也会看到很多参数在参与各种逻辑判断，决定要显示的内容</EM>


##### IF [条件]
*必须带ENDIF才能闭合语句
[条件]可以进行很多逻辑运算，看不懂这部分建议搜索下编程逻辑运算教程学一下，这边仅简要列出一些
相信大于小于大家都知道是什么符号，程序中比较特殊的是==等于====，注意，是两个=表示相等（因为单个等号一般用作赋值了）
如果我们有多个条件需要满足，可以用&&连接
例：FLAG1 > 5 && FLAG2 < 3 需要FLAG1大于5，且FLAG2小于3才能执行下面的语句
如果我们有多个条件只需要满足其中一个即可，可以用||连接
例：FLAG1 > 5 || FLAG2 < 3 只要FLAG1大于5，或FLAG2小于3就能执行下面的语句

例：
```
IF FLAG == 0
        PRINTFORMDW flag等于0时，打印这条数据
ELSEIF FLAG > 0
        PRINTFORMDW flag大于0时，打印这条数据
 ELSE       
       PRINTFORMDW 上面都不满足时候，打印这条数据
ENDIF
```
```
SIF [条件]
不需要写ENDIF的IF语句，但相应后面只能接一条语句
SIF FLAG == 0
        PRINTFORMDW flag等于0时，打印这条数据
 PRINTFORMDW 不管上面一条结果如何，都会打印这条数据
```

##### SELECTCASE [参数]
*必须带ENDSELECT才能闭合语句
作用和IF类似，但有些时候写起来更简单。如果觉得不好理解建议直接IF写
SELECTCASE [参数0]
CASE [参数1/2/3/...] 
CASEELSE 
* 写在SELECTCASE后的参数0，会从上到下，按顺序与CASE后面的参数比较是否相等
* CASE的参数可以是连续的整数，用[整数1 TO 整数2]表示
* 如果需要处理没有符合列出条件的情况，则使用CASEELSE
* 每一段代码结尾需要写上BREAK，否则后面的语句只要满足了也会执行

```
SELECTCASE FLAG
	;1.基礎
	CASE 0 TO 2
		BREAK
	;2.感觉
	CASE 3 TO 6
		BREAK
	;3.性癖
	CASE 7 TO 11
		BREAK
	;4.中毒
	CASE 12 TO 16
		BREAK
	;5.调教
	CASE 20 TO 28
		BREAK
ENDSELECT
```

#### 具体实现
好了，至此所有需要知道的内容，我们都知道了，开始实现丰川祥子对其他人的特殊开场白吧

##### 用IF语句实现
```
IF NO:MASTER == 2
	PRINTFORMDW 对白祥的开场白
ELSEIF NO:MASTER == 3
	PRINTFORMDW 对草莓祥子的开场白
ELSEIF NO:MASTER == 4
	PRINTFORMDW 对初华的开场白
ELSEIF NO:MASTER == 5
	PRINTFORMDW 对初音的开场白
ELSEIF NO:MASTER == 6
	PRINTFORMDW 对AVER的开场白
ELSE
	PRINTFORMW 没有匹配到编号的人用的开场白
	RETURN 1
ENDIF
```

##### SELECTCASE
```
SELECTCASE NO:MASTER
	CASE 2
	    PRINTFORMDW 对白祥的开场白
		BREAK
	CASE 3
        PRINTFORMDW 对草莓祥子的开场白
		BREAK
	CASE 4
        PRINTFORMDW 对初华的开场白
		BREAK
	CASE 5
        PRINTFORMDW 对初音的开场白
		BREAK
	CASE 6
        PRINTFORMDW 对AVER的开场白
		BREAK
    CASEELSE
        PRINTFORMW 没有匹配到编号的人用的开场白
        BREAK
ENDSELECT
```
不只是我给的示例文件，整个项目中有很多IF\SELECTCASE语句，还有非常多类似NO:MASTER的参数，甚至于你也可以自己设置参数，根据不同的参数来决定整个故事的走向，或者增加一些随机性的内容，真的做个多结局的galgame，也是完全可能的
而且上面的这些知识，不只可以写口上，也可以改写其他的内容


## 结语
看完本教程，相信你已经学会了！
好啦，接下来给角色增加触手的工作就交给你啦！(大拇指)


PS:我是真的非常佩服写出ERA游戏引擎，还有反R游戏的人，他们真的太厉害呀，渣包流下佩服的泪水